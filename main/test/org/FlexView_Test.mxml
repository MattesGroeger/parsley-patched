<?xml version="1.0" encoding="utf-8"?>
<mx:Application 	
	xmlns:mx="http://www.adobe.com/2006/mxml"
	xmlns:view="org.spicefactory.parsley.flex.view.*"
	xmlns:pm="org.spicefactory.parsley.flex.modules.*"
	layout="absolute"
    preinitialize="createContext()"
>    
    <mx:Script>
        <![CDATA[
        	import org.spicefactory.parsley.flex.view.ViewContainer;
        	import org.spicefactory.parsley.flex.FlexContextBuilder;
        	import org.spicefactory.parsley.core.Context;
        	import mx.containers.TitleWindow;
        	import mx.managers.PopUpManager;
        	
        	private var context:Context;
                        
            private function createContext () : void {
            	TitleWindow; PopUpManager;
            	trace("BUILD CONTEXT");
                context = FlexContextBuilder.build(ViewContainer);
            }
 
        ]]>
    </mx:Script>    
    
    <mx:ApplicationControlBar dock="true">
		<mx:Button label="Unload module" click="{module.unloadModule();}"/>   
    </mx:ApplicationControlBar>
    
    
    <mx:TabNavigator width="100%" height="100%">
    	<view:Panel1 label="Panel1"/>
    	<view:Panel2 label="Panel2"/>
    	<pm:ModuleLoader id="module" label="Panel3" url="TestModule.swf" parentContext="{context}" width="100%" height="100%"/>
    </mx:TabNavigator>
    
	
</mx:Application>
